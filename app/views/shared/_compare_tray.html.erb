<% return unless user_signed_in? %>
<% ids = compared_product_ids %>
<% return if ids.empty? %>
<% products_by_id = Product.where(id: ids).index_by(&:id) %>

<div class="fixed inset-x-0 bottom-4 z-40">
  <div class="mx-auto max-w-6xl px-4">
    <div class="rounded-2xl border border-base bg-white/95 p-4 shadow-lg backdrop-blur">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.2em] text-stone-400"><%= t("shared.compare.tray_title") %></p>
          <p class="mt-1 text-sm text-stone-600"><%= t("shared.compare.tray_count", count: ids.size) %></p>
        </div>
        <div class="flex items-center gap-3">
          <%= link_to t("shared.compare.open"), compare_path, class: "btn-primary rounded-full px-5 py-2 text-sm" %>
          <%= button_to t("shared.compare.clear"), compare_path, method: :delete,
            class: "rounded-full border border-base px-4 py-2 text-xs font-semibold text-stone-600 hover:border-stone-300" %>
        </div>
      </div>

      <div class="mt-4 grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
        <% ids.each do |product_id| %>
          <% product = products_by_id[product_id] %>
          <% next unless product %>
          <div class="flex items-center gap-3 rounded-2xl border border-base bg-white px-3 py-2">
            <div class="h-12 w-12 overflow-hidden rounded-xl bg-stone-100">
              <% if product.image_url.present? %>
                <%= image_tag product.image_url, class: "h-full w-full object-cover", alt: product.name %>
              <% end %>
            </div>
            <div class="flex-1">
              <p class="text-xs font-semibold text-stone-800"><%= product.name %></p>
              <p class="text-[11px] text-stone-500"><%= product.flavor %></p>
            </div>
            <%= button_to t("shared.compare.remove"),
              compare_item_path(product_id: product.id, return_to: request.fullpath),
              method: :delete,
              class: "rounded-full border border-base px-2 py-1 text-[11px] font-semibold text-stone-500 hover:border-stone-300" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
